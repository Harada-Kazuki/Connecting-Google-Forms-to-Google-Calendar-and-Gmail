# Google使いたおし予約システム
## Google FormsとGoogle Calendarを連携した、重機練習の予約管理システムです。フォーム送信時に自動でカレンダーに予定を登録し、同時間帯の予約数を制限します。

目次
```
機能概要
前提条件
セットアップ手順
動作フロー
設定項目の説明
トラブルシューティング
カスタマイズ例
注意事項
```

## 機能概要
### 本システムは以下の機能を提供します。

自動予約登録 - Google Formsからの予約情報を自動でGoogle Calendarに登録
予約数制限 - 同じ時間帯に最大2名まで予約可能（3名目以降は自動で却下）
予約完了通知 - 予約完了時に管理者へメール通知
予約失敗通知 - 予約失敗時に申込者と管理者の両方へメール通知
エラーハンドリング - エラー発生時の管理者への自動通知


33前提条件
###本システムを利用するには、以下が必要です。
項目説明Google Workspaceアカウントが必要Google Formsフォームの作成権限Google Calendarカレンダーの編集権限Apps Scriptスクリプトの実行権限

## セットアップ手順
### Step 1: Google Formsの作成
以下の質問項目を含むフォームを作成してください。
項目名形式お名前記述式練習日日付開始時刻時刻終了時刻時刻

### 重要: フォーム設定で「メールアドレスを収集する」を有効にしてください。

### Step 2: Google Calendarの準備
カレンダーIDの取得手順:

予約管理用のカレンダーを作成（または既存のカレンダーを使用）
カレンダーの設定を開く
「カレンダーの統合」セクションでカレンダーIDをコピー

### Step 3: Apps Scriptの設定

#### Google Formsを開き、右上の三点メニューから スクリプトエディタ を選択
#### 表示されたエディタに上記コードを貼り付け
#### コード内の設定項目を編集

javascript// --- 設定項目 ---
```
const calendarId = 'あなたのカレンダーID';
const adminEmails = '管理者1@example.com, 管理者2@example.com';
```
4. プロジェクト名を設定（例: 重機練習予約システム）
5. 保存アイコンをクリック

### Step 4: トリガーの設定

1. Apps Scriptエディタで左側のメニューから トリガー アイコンをクリック
2. 右下の トリガーを追加 をクリック
3. 以下のように設定
```
| 設定項目 | 値 |
|----------|-----|
| 実行する関数 | `onFormSubmit` |
| イベントのソース | フォームから |
| イベントの種類 | フォーム送信時 |
```
4. 保存 をクリック

### Step 5: 権限の承認

#### 初回実行時に権限の承認が必要です。

1. Googleアカウントの選択画面が表示されます
2. **詳細** をクリック
3. **安全ではないページに移動** をクリック
4. カレンダーとメールへのアクセス権限を許可

---

## 動作フロー
ユーザー → Google Forms送信
    ↓
スクリプト自動実行
    ↓
既存予約数確認
    ↓
    ├─ 2名以下 → カレンダー登録 → 管理者に通知
    │
    └─ 3名以上 → 予約却下 → 申込者＆管理者に通知

設定項目の説明
calendarId
予約を登録するGoogle CalendarのID

カレンダーの設定画面「カレンダーの統合」から取得
形式例: xxxxx@group.calendar.google.com

adminEmails
予約通知を受け取る管理者のメールアドレス

カンマ区切りで複数指定可能
形式例: admin1@example.com, admin2@example.com


## トラブルシューティング
### 予約が登録されない場合

 #### トリガーが正しく設定されているか確認
 #### カレンダーIDが正確か確認
 #### Apps Scriptの実行権限が付与されているか確認

## メールが届かない場合

 #### 管理者のメールアドレスが正しいか確認
 #### スパムフォルダを確認
 #### Gmailの送信制限（1日あたり100通）に達していないか確認

## エラーメッセージの確認方法

#### Apps Scriptエディタを開く
#### 左側のメニューから 実行数 をクリック
#### 失敗した実行のログを確認


## カスタマイズ例
### 予約可能人数の変更
```
javascriptif (events.length >= 2) {  // この数字を変更（例: 3, 4, 5）
```
イベント名の変更
```
javascriptcalendar.createEvent('重機練習：' + name, start, end);
// 例: '【練習】' + name、'機械操作：' + name など
```
## メール本文のカスタマイズ
#### 以下の変数を編集してメール内容をカスタマイズできます。
```
errorSubject - 予約失敗時の件名
errorBody - 予約失敗時の本文
subject - 予約成功時の件名
body - 予約成功時の本文
```

## 注意事項

### 実行時間制限: Google Apps Scriptの実行時間制限は6分です

### 送信制限: Gmailの送信制限は1日あたり100通です

### セキュリティ: カレンダーIDや管理者メールアドレスは外部に公開しないでください

### テスト: 本番運用前に必ずテスト送信を行ってください


## ライセンス
このスクリプトは自由に改変・利用可能です。

作成日: 2026年2月
バージョン: 1.0.0
